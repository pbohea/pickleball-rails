<% content_for :title, "Find Live Music on the Map" %>

<style>
  .map-main-card {
    background: white;
    border-radius: 24px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    padding: 2rem;
    animation: fadeIn 0.5s ease-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .map-location-box {
    border: 2px solid #e9ecef;
    border-radius: 16px;
    padding: 1rem;
    transition: all 0.3s ease;
  }

  .map-location-box:hover {
    border-color: #0d6efd;
    box-shadow: 0 4px 12px rgba(13, 110, 253, 0.1);
  }

  .map-submit-button {
    background: linear-gradient(135deg, #0d6efd 0%, #0056b3 100%);
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 50px;
    font-weight: 600;
    box-shadow: 0 6px 20px rgba(13, 110, 253, 0.3);
    transition: all 0.3s ease;
  }

  .map-submit-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(13, 110, 253, 0.4);
  }
</style>

<div class="min-vh-100 bg-light">
  <div class="container py-4">
    <div class="row justify-content-center">
      <div class="col-lg-6 col-md-8 col-sm-10">

        <!-- Header Section -->
        <div class="text-center mb-4">
          <div class="mb-3">
            <i class="fas fa-map-marked-alt fa-4x text-primary"></i>
          </div>
        </div>

        <!-- Main Card -->
        <div class="map-main-card">

            <%= form_with url: events_map_path, method: :get, local: true,
              data: {
                controller: "location-search",
                "location-search-current-lat-value": params[:lat],
                "location-search-current-lng-value": params[:lng],
                "location-search-current-address-value": params[:address],
                "location-search-current-radius-value": params[:radius] || 5
              } do |f| %>

              <!-- Location Section -->
              <div class="mb-4">
                <h6 class="fw-semibold mb-3 d-flex align-items-center">
                  <i class="fas fa-map-marker-alt me-2 text-primary"></i>
                  Location
                </h6>

                <!-- Address Option -->
                <div class="map-location-box mb-3">
                  <div class="form-check">
                    <%= radio_button_tag :location_type, "address", true,
                        class: "form-check-input",
                        data: { "location-search-target": "addressRadio" } %>
                    <%= label_tag :location_type_address, class: "form-check-label fw-medium ms-2" do %>
                      <i class="fas fa-search me-2"></i>Enter address
                    <% end %>
                  </div>

                  <%= f.text_field :address,
                      placeholder: "Enter address or ZIP code",
                      class: "form-control mt-2 border-0 bg-light",
                      value: params[:address],
                      data: { "location-search-target": "addressInput" } %>
                </div>

                <!-- Current Location Option -->
                <div class="map-location-box">
                  <div class="form-check">
                    <%= radio_button_tag :location_type, "current", false,
                        class: "form-check-input",
                        data: { "location-search-target": "currentRadio", action: "change->location-search#getCurrentLocation" } %>
                    <%= label_tag :location_type_current, class: "form-check-label fw-medium ms-2" do %>
                      <i class="fas fa-crosshairs me-2"></i>Use my current location
                    <% end %>
                  </div>
                </div>
              </div>

              <!-- Filters Section -->
              <div class="row g-3 mb-4">
                <!-- Search Radius -->
                <div class="col-sm-6">
                  <h6 class="fw-semibold mb-2 d-flex align-items-center">
                    <i class="fas fa-bullseye me-2 text-primary"></i>
                    <span class="small">Search Radius</span>
                  </h6>
                  <%= f.select :radius,
                      options_for_select([
                        ['1 mi', 1], ['5 mi', 5], ['10 mi', 10],
                        ['15 mi', 15], ['25 mi', 25], ['50 mi', 50]
                      ], params[:radius] || 5),
                      {}, class: "form-select border-0 bg-light" %>
                </div>

                <!-- Date Range -->
                <div class="col-sm-6">
                  <h6 class="fw-semibold mb-2 d-flex align-items-center">
                    <i class="fas fa-calendar-alt me-2 text-primary"></i>
                    <span class="small">Time Period</span>
                  </h6>
                  <%= f.select :date_range,
                      options_for_select([
                        ["Any Date", ""],
                        ["Today", "today"],
                        ["Next 7 Days", "next_7_days"]
                      ], params[:date_range]),
                      {}, class: "form-select border-0 bg-light" %>
                </div>
              </div>

              <!-- Error Message -->
              <div id="location-error" class="alert alert-danger d-none mb-3 border-0 rounded-3" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Please enter an address or use your current location before searching.
              </div>

              <!-- Submit Button -->
              <div class="d-grid">
                <button type="submit" class="btn map-submit-button text-white btn-lg">
                  <i class="fas fa-map me-2"></i>
                  Show Events on Map
                </button>
              </div>

              <%= f.hidden_field :lat, data: { "location-search-target": "latInput" } %>
              <%= f.hidden_field :lng, data: { "location-search-target": "lngInput" } %>
            <% end %>

          </div>
        </div>

      </div>
    </div>
  </div>
